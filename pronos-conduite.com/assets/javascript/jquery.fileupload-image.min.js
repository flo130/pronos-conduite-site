(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],e)}else{e(window.jQuery,window.loadImage)}})(function(e,t){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:true,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",disabled:"@disableImageResize"},{action:"saveImage",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"});e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:false,imageCrop:false,disableImageResize:true,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:true,previewThumbnail:true,previewCrop:false,previewCanvas:true},processActions:{loadImage:function(n,r){if(r.disabled){return n}var i=this,s=n.files[n.index],o=e.Deferred();if(e.type(r.maxFileSize)==="number"&&s.size>r.maxFileSize||r.fileTypes&&!r.fileTypes.test(s.type)||!t(s,function(e){if(e.src){n.img=e}o.resolveWith(i,[n])},r)){return n}return o.promise()},resizeImage:function(n,r){if(r.disabled){return n}r=e.extend({canvas:true},r);var i=this,s=e.Deferred(),o=r.canvas&&n.canvas||n.img,u=function(e){if(e&&(e.width!==o.width||e.height!==o.height)){n[e.getContext?"canvas":"img"]=e}n.preview=e;s.resolveWith(i,[n])},a;if(n.exif){if(r.orientation===true){r.orientation=n.exif.get("Orientation")}if(r.thumbnail){a=n.exif.get("Thumbnail");if(a){t(a,u,r);return s.promise()}}}if(o){u(t.scale(o,r));return s.promise()}return n},saveImage:function(t,n){if(!t.canvas||n.disabled){return t}var r=this,i=t.files[t.index],s=i.name,o=e.Deferred(),u=function(e){if(!e.name){if(i.type===e.type){e.name=i.name}else if(i.name){e.name=i.name.replace(/\..+$/,"."+e.type.substr(6))}}t.files[t.index]=e;o.resolveWith(r,[t])};if(t.canvas.mozGetAsFile){u(t.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(i.type)&&s||(s&&s.replace(/\..+$/,"")||"blob")+".png",i.type))}else if(t.canvas.toBlob){t.canvas.toBlob(u,i.type)}else{return t}return o.promise()},loadImageMetaData:function(n,r){if(r.disabled){return n}var i=this,s=e.Deferred();t.parseMetaData(n.files[n.index],function(t){e.extend(n,t);s.resolveWith(i,[n])},r);return s.promise()},saveImageMetaData:function(e,t){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob&&!t.disabled)){return e}var n=e.files[e.index],r=new Blob([e.imageHead,this._blobSlice.call(n,20)],{type:n.type});r.name=n.name;e.files[e.index]=r;return e},setImage:function(e,t){if(e.preview&&!t.disabled){e.files[e.index][t.name||"preview"]=e.preview}return e}}})})